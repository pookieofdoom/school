#include <stdio.h>
#include "MyLib.h"
#include "LZWExp.h"

void Displayvalue(void *format, unsigned char *data, int numBytes) {
   if (data != NULL) {
      for (; numBytes; --numBytes) {
         printf(format, *data++);
      }
   }
}

int main() {
   UInt value = 0;
   int result = 0, scanfResult = 1, bitsLeft, check = 1;
   LZWExp exp;

   LZWExpInit(&exp, Displayvalue, "%c", DEFAULT_RECYCLE_CODE);

   while (!result && scanf("%X", &value) != EOF) {
      result = LZWExpDecode(&exp, value);
   }  

   bitsLeft = exp.bitUnpacker.bitsLeft;
   while (bitsLeft--) {
      check *= 2;
   }
   check--;
      
   if (value & check) {
      printf("Bad code\n");
   }
   else if (result == BAD_CODE) {
      printf("Bad code\n");
   }
   else if (LZWExpStop(&exp) == MISSING_EOD) {
      printf("Missing EOD\n");
   }

   LZWExpDestruct(&exp);
   if (report_space()) {
        printf("%ld\n", report_space());
   }
   
   return 0;
}
